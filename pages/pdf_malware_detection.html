
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <link rel="icon" />
  <link rel="icon" href="../image/ml-fusion-lab-logo.png" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Malware Detection</title>
  <link rel="stylesheet" href="../style/scroll.css" />
  <link rel="stylesheet" href="../style/style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <style>
    .project-container {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
      margin: 0 auto;
      padding-left: 50px;
      padding-right: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    
    @media (max-width: 600px) {
      .project-container {
        font-size: 0.9em;
        padding: 1em;
      }
      .project-container h1 {
        font-size: 1.8em;
      }
    }

    @media print {
      .project-container {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }

      .project-container p,
      .project-container h2,
      .project-container h3 {
        orphans: 3;
        widows: 3;
      }

      .project-container h2,
      .project-container h3,
      .project-container h4 {
        page-break-after: avoid;
      }
    }
    header {
      height: 100px;
    }

    .logo {
      margin: 30px 0 0 0;
    }

    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 20px 0;
      margin-top: auto;
    }

    .footer-container {
      max-width: 800px;
      margin: auto;
      padding: 0 20px;
    }

    .footer-links,
    .footer-socials,
    .footer-contact {
      margin: 10px 0;
    }

    .footer-links a,
    .footer-socials a {
      color: white;
      text-decoration: none;
      margin: 0 10px;
      transition: color 0.3s;
    }

    .footer-links a:hover,
    .footer-socials a:hover {
      color: #007bff;
    }

    .footer-socials a {
      font-size: 24px;
      margin: 0 15px;
    }

    .footer-contact a {
      color: white;
    }


  #scrollTopBtn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 30px;
      z-index: 101;
      font-size: 18px;
      background-color: #00bfff;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
    }

    #scrollTopBtn:hover {
      background-color: #555;
    } 

.project-container {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f8f8f8;
    padding: 20px;
}

.project-container h1 {
    margin: 0;
}

.project-container h2 {
    color: #2c3e50;
    border-bottom: 2px solid #4a90e2;
    padding-bottom: 10px;
}

.project-container h3 {
    color: #34495e;
}

.project-container h4 {
    color: #2980b9;
}

.project-container p, .project-container ul {
    margin-bottom: 15px;
}

.project-container pre {
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
    overflow-x: auto;
}

.project-container code {
    font-family: 'Courier New', Courier, monospace;
    color: black;
}

.project-container ul {
    padding-left: 20px;
}

/* Dark Theme */
body.dark-mode .project-container {
    color: #e0e0e0;
    background-color: #2a2a2a;
}


body.dark-mode .project-container h2 {
    color: #9ab;
    border-bottom-color: #567;
}

body.dark-mode .project-container h3 {
    color: #abc;
}

body.dark-mode .project-container h4 {
    color: #89a;
}

body.dark-mode .project-container pre {
    background-color: #333;
    border-color: #555;
}

body.dark-mode .project-container code {
    color: white;
}

/* Responsive Design */
@media (max-width: 768px) {
    .project-container {
        padding: 10px;
    }

    .project-container .header {
        padding: 15px;
    }

    .project-container h1 {
        font-size: 24px;
    }

    .project-container h2 {
        font-size: 20px;
    }

    .project-container h3 {
        font-size: 18px;
    }

    .project-container h4 {
        font-size: 16px;
    }

    .project-container pre {
        padding: 10px;
    }
}
/* css for mouse cursor trail effect */
.circle {
    position: absolute;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    pointer-events: none;
    background: radial-gradient(circle, rgba(70, 130, 180, 0.3),skyblue, rgba(0, 0, 50, 0.3),white);
    transition: transform 0.1s, left 0.1s, top 0.1s;
  }
  
  .circle-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999; /* removed the non-breaking space (&nbsp;) */
  }
  #scrollTopBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 105px;
        z-index: 99;
        background-color: #00bfff;
        color: white;
        border: none;
        border-radius: 50%;
      }

      #scrollTopBtn:hover {
        background-color: #555;
      }
      .ani {
        display: flex;
        padding: 0.5em 0;
        justify-content: center;
        align-items: center;
        background-color: #4a90e2;
        color: white;
        font-weight: bold;
        text-align: center;
        animation: colorChange 8s infinite;
      }
      body.dark-mode .ani {
        color: #1c2e3e;
      }
      @keyframes colorChange {
        0% {
          background-color: #4a90e2;
        }
        50% {
          background-color: #50b3a2;
        }
        100% {
          background-color: #4a90e2;
        }
      }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <a href="../index.html">
        <h1>
          <img src="../image/ml fusion lab log.jpg" alt="logo" width="100" height="100" />
        </h1>
      </a>
    </div>
    <nav>
      <div class="hamburger" id="hamburger">&#9776;</div>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../pages/courses.html">Courses</a></li>
        <li><a href="../pages/projects.html">Projects</a></li>
        <li><a href="../pages/about.html">About Us</a></li>
        <li><a href="../pages/contact.html">Contact</a></li>
        <li><a href="../pages/community_suport.html">Community Support</a></li>

        <li><a href="../pages/feedback.html">Feedback</a></li>
        <div class="theme-switch" id="theme-switch"></div>
      </ul>
    </nav>
  </header>
  <div class="circle-container">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
</div>
<div class="project-container">
    <div class="header ani">
        <h1>Comprehensive Guide to PDF Malware Detection</h1>
    </div>
    
    <h2>Overview</h2>
    <p>
        This guide provides a detailed explanation of the PDF malware detection process, from dataset analysis to the implementation of a detection system using machine learning techniques. It involves extracting features from PDF files and classifying them as either benign or potentially malicious using trained models.
    </p>

    <h2>1. Dataset Analysis and Model Training</h2>

    <h3>1.1 Importing Required Modules</h3>
    <pre><code>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.preprocessing import StandardScaler
from imblearn.over_sampling import RandomOverSampler
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, accuracy_score
import xgboost as xgb
import joblib</code></pre>
    <p>Additional tip: Use <code>seaborn</code> to visualize correlations between features to improve feature selection.</p>

    <h3>1.2 Loading and Preparing the Dataset</h3>
    <pre><code>df = pd.read_csv(r"Dataset/PDFMalware2022.csv")</code></pre>
    <p>Inspect the dataset using <code>df.info()</code> and <code>df.describe()</code> to understand its structure and statistics.</p>

    <h3>1.3 Data Cleaning and Preprocessing</h3>
    <pre><code>df["header"] = [label.split('-')[1] for label in df['header']]
df['Class'] = df['Class'].replace(['Benign', 'Malicious'], [0, 1])</code></pre>

    <h3>1.4 Splitting the Dataset</h3>
    <pre><code>train, test = np.split(df.sample(frac=1), [int(0.6 * len(df))])</code></pre>

    <h3>1.5 Scaling and Oversampling</h3>
    <pre><code>def scale_dataset(dataframe, oversample=False):
    X = dataframe[dataframe.columns[0:-1]].values
    y = dataframe[dataframe.columns[-1]].values
    data = np.hstack((X, np.reshape(y, (-1, 1))))
    return data, X, y

train, X_train, y_train = scale_dataset(train, oversample=True)
test, X_test, y_test = scale_dataset(test, oversample=False)</code></pre>

    <h3>1.6 Model Training and Evaluation</h3>
    <pre><code>rf_model = RandomForestClassifier(n_estimators=400, max_depth=40, bootstrap=True)
rf_model.fit(X_train, y_train)
y_pred_rf = rf_model.predict(X_test)
print("Random Forest Accuracy:", accuracy_score(y_test, y_pred_rf))

model = xgb.XGBClassifier(objective='binary:logistic', eval_metric='logloss', random_state=42)
model.fit(X_train, y_train)
y_pred = model.predict(X_test)
print("XGBoost Accuracy:", accuracy_score(y_test, y_pred))</code></pre>
    <p>Additional step: Plot confusion matrices to visualize misclassifications.</p>

    <h3>1.7 Saving the Model</h3>
    <pre><code>joblib.dump(rf_model, 'saved_models/random_forest_model.pkl')</code></pre>

    <h2>2. PDF Malware Detection Process</h2>

    <h3>2.1 Feature Extraction</h3>
<p>The feature extraction process involves systematically collecting relevant attributes from a PDF file to help identify potential threats. This process uses <strong>PyMuPDF (fitz)</strong> and <strong>pdfid</strong> libraries. Below is a step-by-step breakdown:</p>

<h4>Step 1: Import Required Libraries</h4>
<pre><code class="language-python">
from pdfid import pdfid
import fitz
from os.path import exists
import sys
</code></pre>
<p>
  <strong>Explanation:</strong>
  We import necessary modules: 
  <ul>
    <li><strong>fitz:</strong> For extracting metadata and content from PDFs.</li>
    <li><strong>pdfid:</strong> To scan PDFs for specific attributes (like JavaScript actions).</li>
    <li><strong>os.path:</strong> For checking if a file exists.</li>
    <li><strong>sys:</strong> To handle command-line arguments.</li>
  </ul>
</p>

<h4>Step 2: Define Helper Function</h4>
<pre><code class="language-python">
# Convert bytes to kilobytes
def bytes_to_kb(bytes):
    return bytes / 1024
</code></pre>
<p><strong>Explanation:</strong> This helper function converts byte values to kilobytes for easier readability.</p>

<h4>Step 3: Check if the PDF Exists and Initialize Features</h4>
<pre><code class="language-python">
def extract_pdf_features(pdf_file):
    # Check if the file exists
    if not exists(pdf_file):
        print(f"File {pdf_file} not found")
        return None

    # Initialize features dictionary
    features = {'FileName': pdf_file}
</code></pre>
<p><strong>Explanation:</strong> We first check if the provided file exists. If not, the function returns <code>None</code>. A dictionary named <code>features</code> is initialized to store the extracted attributes.</p>

<h4>Step 4: Extract Basic Metadata</h4>
<pre><code class="language-python">
    pdf = fitz.open(pdf_file)  # Open the PDF

    # Extract metadata
    try:
        features['Pages'] = pdf.page_count
    except:
        features['Pages'] = -1

    try:
        features['XrefLength'] = pdf.xref_length()
    except:
        features['XrefLength'] = -1

    try:
        features['TitleCharacters'] = len(pdf.metadata.get('title', ''))
    except:
        features['TitleCharacters'] = -1

    features['isEncrypted'] = 1 if pdf.is_encrypted else 0
</code></pre>
<p><strong>Explanation:</strong> 
<ul>
  <li><strong>Pages:</strong> Total number of pages in the PDF.</li>
  <li><strong>Xref Length:</strong> Length of the cross-reference table.</li>
  <li><strong>Title Characters:</strong> Length of the title field in metadata (if available).</li>
  <li><strong>isEncrypted:</strong> A binary value indicating if the PDF is encrypted.</li>
</ul></p>

<h4>Step 5: Extract Image and Embedded File Details</h4>
<pre><code class="language-python">
    # Extract image-related features
    images_count = 0
    for i in range(pdf.page_count):
        images_count += len(pdf.get_page_images(i))
    features['Images'] = images_count

    # Extract embedded file details
    emb_count = pdf.embfile_count()
    emb_size_sum = 0
    if emb_count != 0:
        try:
            for i in range(emb_count):
                emb_size_sum += pdf.embfile_info(i)
        except:
            features['EmbeddedFiles'] = -1
        else:
            features['EmbeddedFiles'] = emb_size_sum / emb_count
    else:
        features['EmbeddedFiles'] = 0
</code></pre>
<p><strong>Explanation:</strong> 
<ul>
  <li><strong>Images:</strong> Counts all the images present in the PDF.</li>
  <li><strong>Embedded Files:</strong> If the PDF contains embedded files, it calculates their average size. If no files are embedded, it returns 0.</li>
</ul></p>

<h4>Step 6: Check for Text Presence</h4>
<pre><code class="language-python">
    # Check for the presence of text in the PDF
    text = 0
    for page in pdf:
        if len(page.get_text().split()):
            text = 1
            break
    features['Text'] = text

    pdf.close()  # Close the PDF after processing
</code></pre>
<p><strong>Explanation:</strong> If the PDF contains text on any page, the <code>Text</code> attribute is set to 1; otherwise, it remains 0.</p>

<h4>Step 7: Extract Additional Features Using pdfid</h4>
<pre><code class="language-python">
    try:
        options = pdfid.get_fake_options()
        options.scan = True
        options.json = True
        list_of_dict = pdfid.PDFiDMain([pdf_file], options)
        pdf_features = list_of_dict['reports'][0]
        del pdf_features['version']

        # Rename features to match dataset requirements
        diff_in_feature_name = {
            'header': 'Header', 'obj': 'Obj', 'endobj': 'Endobj',
            'stream': 'Stream', 'endstream': 'Endstream', 'xref': 'Xref',
            'trailer': 'Trailer', 'startxref': 'StartXref', '/Page': 'PageNo',
            '/Encrypt': 'Encrypt', '/ObjStm': 'ObjStm', '/JS': 'JS',
            '/JavaScript': 'JavaScript', '/AA': 'AA', '/OpenAction': 'OpenAction',
            '/AcroForm': 'AcroForm', '/JBIG2Decode': 'JBIG2Decode', 
            '/RichMedia': 'RichMedia', '/Launch': 'Launch', '/EmbeddedFile': 'EmbeddedFile',
            '/XFA': 'XFA', '/Colors > 2^24': 'Colors'
        }

        for curr_name, new_name in diff_in_feature_name.items():
            pdf_features[new_name] = features.pop(curr_name, -1)

        features.update(pdf_features)
    except Exception as e:
        print(f"Error extracting pdfid features: {e}")
</code></pre>
<p><strong>Explanation:</strong> This step uses <code>pdfid</code> to extract specific features related to potentially malicious actions, such as JavaScript or embedded launch actions. The extracted features are renamed to match the dataset structure.</p>

<h4>Step 8: Handle Errors and Return Features</h4>
<pre><code class="language-python">
    return features
</code></pre>
<p><strong>Explanation:</strong> The function returns the collected features as a dictionary for further processing or classification.</p>

<h4>Step 9: Running the Script from Command Line</h4>
<pre><code class="language-python">
if __name__ == '__main__':
    if len(sys.argv) != 2:
        print("Usage: python pdf_feature_extraction.py <pdf_file>")
        sys.exit(1)

    pdf_file = sys.argv[1]
    features = extract_pdf_features(pdf_file)
    
    if features:
        print(features)
</code></pre>
<p><strong>Explanation:</strong> This code allows the script to be run from the command line. It takes the PDF filename as an argument, extracts the features, and prints them.</p>


    <h3>2.2 Feature Processing</h3>
    <pre><code>def header_to_numeric(header):
    if header.startswith('%PDF-'):
        return float(header.split('-')[1])
    return 0</code></pre>

    <h3>2.3 Loading the Pre-trained Model</h3>
    <pre><code>model = joblib.load('saved_models/random_forest_model.pkl')</code></pre>

    <h3>2.4 Making Predictions</h3>
    <pre><code>prediction = model.predict([feature_vector])</code></pre>

    <h3>2.5 Interpreting Results</h3>
    <pre><code>if prediction[0] == 1:
    print("The PDF might be Malicious.")
else:
    print("The PDF is clean.")</code></pre>

    <h2>3. Important Considerations</h2>
    <ul>
        <li>Maintain a balance between accuracy and false positives.</li>
        <li>Update models regularly to handle new malware variants.</li>
        <li>This tool should complement other security measures.</li>
    </ul>

    <p>By leveraging machine learning and detailed PDF analysis, this process provides an automated way to assess the potential risks of PDF files, helping to enhance cybersecurity efforts.</p>
</div>

<footer>
    <div class="container">
      <div class="footer-socials">
        Follow us on:
        <a href="https://facebook.com" target="_blank"><svg style="width: 10px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M80 299.3V512H196V299.3h86.5l18-97.8H196V166.9c0-51.7 20.3-71.5 72.7-71.5c16.3 0 29.4 .4 37 1.2V7.9C291.4 4 256.4 0 236.2 0C129.3 0 80 50.5 80 159.4v42.1H14v97.8H80z"/></svg></a>
        <a href="https://twitter.com" target="_blank"><svg style="width: 15px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg></i></a>
        <a href="https://linkedin.com" target="_blank"><svg style="width: 15px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M100.3 448H7.4V148.9h92.9zM53.8 108.1C24.1 108.1 0 83.5 0 53.8a53.8 53.8 0 0 1 107.6 0c0 29.7-24.1 54.3-53.8 54.3zM447.9 448h-92.7V302.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V448h-92.8V148.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V448z"/></svg></i></a>
      </div>
      <div class="footer-contact">
        <div>
          Contact us:
          <a href="mailto:info@mlfusionlabs.com" style="color: white">info@mlfusionlabs.com</a>
          | Phone: +1 (555) 123-4567
        </div>
      </div>
      <div class="footer-links">
        <a href="../pages/privacy.html">Privacy Policy</a> |
        <a href="../pages/terms.html">Terms of Service</a> |
        <a href="../pages/about.html">About Us</a> |
        <a href="../pages/contact.html">Contact</a> |
        <a href="../pages/contributor.html">Contributor</a>
      </div>
      <div>&copy; 2024 ML Fusion Labs | All Rights Reserved</div>
    </div>
    <button id="scrollTopBtn" onclick="scrollToTop()">
      <svg style="width: 20px;"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#ffffff" d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2 160 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-306.7L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"/></svg>    </button>
  </footer>
  <script src="../script/scroll.js"></script>
    <script src="../script/script.js"></script>
    <script src="../script/projects.js"></script>
    <!-- js for mouse cursor trail effect -->
    <script>
            const scrollTopBtn = document.getElementById("scrollTopBtn");
      window.onscroll = function () {
        if (
          document.body.scrollTop > 20 ||
          document.documentElement.scrollTop > 20
        ) {
          scrollTopBtn.style.display = "block";
        } else {
          scrollTopBtn.style.display = "none";
        }
      };

      function scrollToTop() {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }
      document.addEventListener("DOMContentLoaded", function () {
    const coords = { x: 0, y: 0 };
    const circles = document.querySelectorAll(".circle");

    circles.forEach(function (circle, index) {
        circle.x = 0;
        circle.y = 0;
    });

    window.addEventListener("mousemove", function (e) {
        coords.x = e.clientX;
        coords.y = e.clientY;
    });

    function animateCircles() {
        let x = coords.x;
        let y = coords.y;

        circles.forEach(function (circle, index) {
            circle.style.left = x + "px";
            circle.style.top = y + "px";
            
            circle.style.scale = (circles.length - index) / circles.length;
            circle.x = x;
            circle.y = y;

            const nextCircle = circles[index + 1] || circles[0];
            x += (nextCircle.x - x) * 0.3;
            y += (nextCircle.y - y) * 0.3;
        });

        requestAnimationFrame(animateCircles);
    }

    animateCircles();
});
    </script>

    <!-- Botpress Chat Scripts -->
    <script src="https://cdn.botpress.cloud/webchat/v2.2/inject.js"></script>
    <script src="https://files.bpcontent.cloud/2024/10/06/10/20241006104845-C8MQIMON.js"></script>
    <script>
      // Get the current year
      const currentYear = new Date().getFullYear();

      // Update the HTML content
      document.getElementById("current-year").textContent = currentYear;
    </script>
  </body>
</html>
