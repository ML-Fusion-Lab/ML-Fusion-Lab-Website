<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Birth Rate Prediction</title>
  <link rel="stylesheet" href="../style/style.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      margin: 0;
      padding: 0;
      transition: background-color 0.3s, color 0.3s;
    }

    .content {
      margin: 20px auto;
      padding: 20px;
    }

    h1,
    h2,
    h3 {
      color: #2c3e50;
      transition: color 0.3s;
    }

    code {
      background-color: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: block;
      padding: 10px;
      white-space: pre-wrap;
      transition: background-color 0.3s, border-color 0.3s;
    }

    /* css for mouse cursor trail effect */
    .circle {
      position: absolute;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      pointer-events: none;
      background: radial-gradient(circle,
          rgba(70, 130, 180, 0.3),
          skyblue,
          rgba(0, 0, 50, 0.3),
          white);
      transition: transform 0.1s, left 0.1s, top 0.1s;
    }

    .circle-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      /* removed the non-breaking space (&nbsp;) */
    }

    .note {
      background-color: #e7f3fe;
      border-left: 6px solid #2196f3;
      margin-bottom: 15px;
      padding: 4px 12px;
      transition: background-color 0.3s, border-left-color 0.3s;
    }

    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 20px 0;
      margin-top: auto;
    }

    .footer-container {
      max-width: 800px;
      margin: auto;
      padding: 0 20px;
    }

    .footer-links,
    .footer-socials,
    .footer-contact {
      margin: 10px 0;
    }

    .footer-links a,
    .footer-socials a {
      color: white;
      text-decoration: none;
      margin: 0 10px;
      transition: color 0.3s;
    }

    .footer-links a:hover,
    .footer-socials a:hover {
      color: #007bff;
    }

    .footer-socials a {
      font-size: 24px;
      margin: 0 15px;
    }

    .footer-contact a {
      color: white;
    }

    .ani {
      display: flex;
      padding: 0.5em 0;
      justify-content: center;
      align-items: center;
      background-color: #4a90e2;
      color: white;
      font-weight: bold;
      text-align: center;
      animation: colorChange 8s infinite;
    }

    body.dark-mode .ani {
      color: #1c2e3e;
    }

    @keyframes colorChange {
      0% {
        background-color: #4a90e2;
      }

      50% {
        background-color: #50b3a2;
      }

      100% {
        background-color: #4a90e2;
      }
    }

    /* Dark mode styles */
    body.dark-mode {
      background-color: #1a1a1a;
      color: #f0f0f0;
    }

    body.dark-mode h1,
    body.dark-mode h2,
    body.dark-mode h3 {
      color: #58a6ff;
    }

    body.dark-mode code {
      background-color: #2b2b2b;
      border-color: #444;
      color: #e6e6e6;
    }

    body.dark-mode .note {
      background-color: #1c2e3e;
      border-left-color: #58a6ff;
    }

    body.dark-mode header {
      background-color: #2c2c2c;
    }

    body.dark-mode nav ul li a {
      color: #f0f0f0;
    }

    #scrollTopBtn {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 105px;
      z-index: 99;
      font-size: 26px;
      background-color: #00bfff;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 50%;
    }

    #scrollTopBtn:hover {
      background-color: #555;
    }
  </style>
</head>

<body>
  <div class="circle-container">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
  </div>
  <header>
    <div class="logo">
      <a href="../index.html">
        <h1>
          <img src="../image/ml fusion lab log.jpg" alt="logo" width="100" height="100" />
        </h1>
      </a>
    </div>
    <nav>
      <div class="hamburger" id="hamburger">&#9776;</div>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../pages/courses.html">Courses</a></li>
        <li><a href="../pages/projects.html">Projects</a></li>
        <li><a href="../pages/about.html">About Us</a></li>
        <li><a href="../pages/contact.html">Contact</a></li>
        <li>
          <a href="../pages/community_suport.html">Community Support</a>
        </li>
        <li><a href="../pages/feedback.html">Feedback</a></li>
        <!-- <div class="theme-switch" id="theme-switch"></div> -->
        <div id="themeSwitch" class="theme-switch">
          <input type="checkbox" class="checkbox" id="checkbox">
          <label for="checkbox" class="checkbox-label">

            <img src="../Assets/sun.png" class="theme-btn">
            <img src="../Assets/moon.png" class="theme-btn">
            <!-- <i class="fas fa-moon"></i>
              <i class="fas fa-sun"></i> -->
            <span class="ball"></span>
          </label>
        </div>
      </ul>
    </nav>
  </header>
  <div class="content">
    <h1 class="ani">Detailed Time Series Forecasting and Testing Explanation</h1>

    <section>
      <h2>1. Import Libraries and Data Preparation</h2>
      <pre><code>
import pandas as pd
import numpy as np
from prophet import Prophet
from prophet.plot import add_changepoints_to_plot
from statsmodels.tsa.arima.model import ARIMA
import matplotlib.pyplot as plt
import seaborn as sns
import tensorflow as tf
from sklearn.metrics import mean_absolute_error, mean_squared_error
import warnings
from math import sqrt

warnings.filterwarnings("ignore")

df = pd.read_csv("daily-total-births.csv", parse_dates=['date'], date_parser=pd.to_datetime)
df.columns = ['ds', 'y']
df.head()
        </code></pre>
      <p>This section imports necessary libraries for data manipulation (pandas, numpy), time series forecasting
        (Prophet, ARIMA), deep learning (TensorFlow), visualization (matplotlib, seaborn), and evaluation metrics. It
        also loads the dataset from a CSV file, parsing dates and renaming columns to match Prophet's required format
        ('ds' for date and 'y' for the target variable).</p>
    </section>

    <section>
      <h2>2. Data Visualization</h2>
      <pre><code>
plt.figure(figsize=(10, 6))
plt.plot(df['ds'], df['y'], label='Daily Births')
plt.title('Daily  Births in 1959')
plt.xlabel('Date')
plt.ylabel('Number of Births')
plt.legend()
plt.show()
        </code></pre>
      <p>This code creates a line plot of the daily births data. It helps visualize trends, seasonality, and any
        anomalies in the data over time.</p>
    </section>

    <section>
      <h2>3. Prophet Model</h2>
      <code>
m = Prophet(yearly_seasonality=True, changepoint_prior_scale=0.5, seasonality_mode='multiplicative')
m.fit(df)

future = m.make_future_dataframe(periods=50, freq='D')
forecast = m.predict(future)

m.plot_components(forecast)
plt.show()

m.plot(forecast)
plt.title('Prophet Forecast')
plt.show()
        </code>
      <p>This section creates and fits a Prophet model to the data. It then generates future dates and makes
        predictions. The model components (trend, yearly seasonality) and the overall forecast are plotted. The Prophet
        model is configured with yearly seasonality and multiplicative seasonality mode, which is suitable for data
        where the seasonal variations increase with the trend.</p>
    </section>

    <section>
      <h2>4. Evaluate Prophet Model</h2>
      <pre><code>
y_true = df['y'].values
y_pred = forecast['yhat'][:len(df)].values

mae = mean_absolute_error(y_true, y_pred)
mse = mean_squared_error(y_true, y_pred)
rmse = sqrt(mse)

print(f"Prophet Model - MAE: {mae:.2f}, MSE: {mse:.2f}, RMSE: {rmse:.2f}")
        </code></pre>
      <p>This code evaluates the Prophet model's performance using Mean Absolute Error (MAE), Mean Squared Error (MSE),
        and Root Mean Squared Error (RMSE). These metrics provide a measure of the average prediction error in the
        model.</p>
    </section>

    <section>
      <h2>5. ARIMA Model</h2>
      <pre><code>
arima_model = ARIMA(df['y'], order=(5, 1, 0)).fit()

arima_forecast = arima_model.predict(start=len(df), end=len(df) + 49, typ='levels')

plt.figure(figsize=(10, 6))
plt.plot(df['ds'], df['y'], label='Original')
plt.plot(pd.date_range(df['ds'].max(), periods=50, freq='D'), arima_forecast, label='ARIMA Forecast', color='red')
plt.title('ARIMA Forecast')
plt.xlabel('Date')
plt.ylabel('Number of Births')
plt.legend()
plt.show()
        </code></pre>
      <p>This section fits an ARIMA model to the data. The order (5,1,0) specifies an ARIMA(5,1,0) model, which means 5
        autoregressive terms, 1 difference, and 0 moving average terms. The model is then used to forecast 50 periods
        ahead, and the results are plotted against the original data.</p>
    </section>

    <section>
      <h2>6. Evaluate ARIMA Model</h2>
      <pre><code>
arima_mae = mean_absolute_error(y_true[-50:], arima_forecast[:50])
arima_mse = mean_squared_error(y_true[-50:], arima_forecast[:50])
arima_rmse = sqrt(arima_mse)

print(f"ARIMA Model - MAE: {arima_mae:.2f}, MSE: {arima_mse:.2f}, RMSE: {arima_rmse:.2f}")
        </code></pre>
      <p>Similar to the Prophet model evaluation, this code calculates MAE, MSE, and RMSE for the ARIMA model, providing
        a basis for comparison between the two models.</p>
    </section>

    <section>
      <h2>7. LSTM Model Preparation</h2>
      <pre><code>
data = df['y'].values
train_size = int(len(data) * 0.8)
train, test = data[:train_size], data[train_size:]

def create_dataset(dataset, look_back=1):
    X, Y = [], []
    for i in range(len(dataset) - look_back - 1):
        X.append(dataset[i:(i + look_back)])
        Y.append(dataset[i + look_back])
    return np.array(X), np.array(Y)

look_back = 5
X_train, y_train = create_dataset(train, look_back)
X_test, y_test = create_dataset(test, look_back)

X_train = np.reshape(X_train, (X_train.shape[0], X_train.shape[1], 1))
X_test = np.reshape(X_test, (X_test.shape[0], X_test.shape[1], 1))
        </code></pre>
      <p>This section prepares the data for the LSTM model. It splits the data into training and testing sets, creates
        sequences of data (with a look_back period of 5), and reshapes the data to fit the LSTM input requirements
        (samples, time steps, features).</p>
    </section>

    <section>
      <h2>8. LSTM Model Building and Training</h2>
      <pre><code>
lstm_model = tf.keras.Sequential([
    tf.keras.layers.LSTM(50, input_shape=(look_back, 1)),
    tf.keras.layers.Dense(1)
])
lstm_model.compile(optimizer='adam', loss='mean_squared_error')

lstm_model.fit(X_train, y_train, epochs=10, batch_size=1, verbose=2)
        </code></pre>
      <p>This code builds and trains the LSTM model. The model consists of an LSTM layer with 50 units, followed by a
        Dense layer for output. It's compiled with Adam optimizer and Mean Squared Error loss function, then trained for
        10 epochs.</p>
    </section>

    <section>
      <h2>9. LSTM Predictions and Visualization</h2>
      <pre><code>
lstm_train_pred = lstm_model.predict(X_train)
lstm_test_pred = lstm_model.predict(X_test)

plt.figure(figsize=(10, 6))
plt.plot(data, label='Original Data')
plt.plot(range(look_back, look_back + len(lstm_train_pred)), lstm_train_pred, label='Train Predictions')
plt.plot(range(len(data) - len(lstm_test_pred), len(data)), lstm_test_pred, label='Test Predictions')
plt.title('LSTM Predictions')
plt.xlabel('Time')
plt.ylabel('Number of Births')
plt.legend()
plt.show()
        </code></pre>
      <p>This section uses the trained LSTM model to make predictions on both the training and test data, then
        visualizes these predictions alongside the original data.</p>
    </section>

    <section>
      <h2>10. Evaluate LSTM Model</h2>
      <pre><code>
lstm_rmse = sqrt(mean_squared_error(y_test, lstm_test_pred))
print(f"LSTM Model - RMSE: {lstm_rmse:.2f}")
        </code></pre>
      <p>This code calculates the RMSE for the LSTM model on the test data, providing a measure of its predictive
        accuracy.</p>
    </section>

    <section>
      <h2>11. Model Comparison</h2>
      <pre><code>
results = pd.DataFrame({
    'Model': ['Prophet', 'ARIMA', 'LSTM'],
    'MAE': [mae, arima_mae, None],  # LSTM does not have MAE calculated
    'RMSE': [rmse, arima_rmse, lstm_rmse]
})

print("Model Performance Summary:")
print(results)
        </code></pre>
      <p>This section creates a summary table comparing the performance metrics (MAE and RMSE) of all three models,
        allowing for easy comparison of their predictive accuracy.</p>
    </section>

    <section>
      <h2>12. Model Saving</h2>
      <pre><code>
import pickle

with open("models/prophet_model.pkl", 'wb') as f:
    pickle.dump(m, f)

lstm_model.save("models/lstm_model.h5")

with open("models/scaler.pkl", 'wb') as f:
    pickle.dump(scaler, f)

with open("models/arima_model.pkl", 'wb') as f:
    pickle.dump(arima_model, f)
        </code></pre>
      <p>This final section saves all the trained models (Prophet, LSTM, and ARIMA) as well as the scaler used for LSTM
        data preparation. This allows for easy reloading and reuse of the models in future analyses or applications.</p>
    </section>

    <section>
      <h2>13. Testing Notebook</h2>
      <p>The testing notebook complements the main notebook by ensuring that all components are working as expected. It
        verifies data loading, model predictions, and the existence of saved model files.</p>

      <h3>13.1 Import Statements and Setup</h3>
      <pre><code>
import unittest
import pandas as pd
import numpy as np
from prophet import Prophet
from statsmodels.tsa.arima.model import ARIMA
import tensorflow as tf
from sklearn.preprocessing import MinMaxScaler
import pickle
import os
import warnings

warnings.filterwarnings("ignore")
        </code></pre>
      <p>This section imports the necessary libraries for testing, including unittest for the testing framework and the
        same libraries used in the main notebook for data manipulation and modeling.</p>

      <h3>13.2 Test Class Definition</h3>
      <pre><code>
class TestNotebookFunctions(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        # Load data
        cls.df = pd.read_csv("daily-total-births.csv", parse_dates=['date'], date_parser=pd.to_datetime)
        cls.df.columns = ['ds', 'y']

        # Load models
        with open("models/prophet_model.pkl", 'rb') as f:
            cls.prophet_model = pickle.load(f)
        
        with open("models/arima_model.pkl", 'rb') as f:
            cls.arima_model = pickle.load(f)
        
        cls.lstm_model = tf.keras.models.load_model("models/lstm_model.h5")
        
        with open("models/scaler.pkl", 'rb') as f:
            cls.scaler = pickle.load(f)
        </code></pre>
      <p>This defines the test class and its setup method. The setup method loads the data and the saved models, which
        will be used in the subsequent tests.</p>

      <h3>13.3 Data Loading Test</h3>
      <pre><code>
    def test_data_loading(self):
        self.assertIsInstance(self.df, pd.DataFrame)
        self.assertEqual(self.df.columns.tolist(), ['ds', 'y'])
        self.assertGreater(len(self.df), 0)
        </code></pre>
      <p>This test checks if the data is loaded correctly, ensuring it's a DataFrame, has the correct columns, and
        contains data.</p>

      <h3>13.4 Prophet Model Test</h3>
      <pre><code>
    def test_prophet_model(self):
        future = self.prophet_model.make_future_dataframe(periods=50, freq='D')
        forecast = self.prophet_model.predict(future)
        self.assertIsInstance(forecast, pd.DataFrame)
        self.assertGreater(len(forecast), len(self.df))
        </code></pre>
      <p>This test checks if the Prophet model can make predictions and if the forecast has the expected structure and
        length.</p>

      <h3>13.5 ARIMA Model Test</h3>
      <pre><code>
    def test_arima_model(self):
        arima_forecast = self.arima_model.forecast(steps=50)
        self.assertEqual(len(arima_forecast), 50)
        </code></pre>
      <p>This test verifies if the ARIMA model can make predictions and if the forecast has the expected length.</p>

      <h3>13.6 LSTM Model Test</h3>
      <pre><code>
    def test_lstm_model(self):
        look_back = 3
        test_data = self.scaler.transform(self.df[['y']].values[-look_back:])
        test_data = test_data.reshape((1, look_back, 1))
        
        lstm_pred = self.lstm_model.predict(test_data)
        
        self.assertEqual(lstm_pred.shape, (1, 1))
        </code></pre>
      <p>This test checks if the LSTM model can make predictions and if the prediction has the expected shape.</p>

      <h3>13.7 Model Files Existence Test</h3>
      <pre><code>
    def test_model_files_exist(self):
        self.assertTrue(os.path.exists("models/prophet_model.pkl"))
        self.assertTrue(os.path.exists("models/arima_model.pkl"))
        self.assertTrue(os.path.exists("models/lstm_model.h5"))
        self.assertTrue(os.path.exists("models/scaler.pkl"))
        </code></pre>
      <p>This test verifies if all the saved model files exist in the expected location.</p>

      <h3>13.8 Running the Tests</h3>
      <pre><code>
if __name__ == '__main__':
    unittest.main
    </code>
</div>
    <footer>
        <div class="container">
          <div class="footer-socials">
            Follow us on:
            <a href="https://facebook.com" target="_blank">
              <svg
                style="width: 10px"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 320 512"
              >
                <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                <path
                  fill="#ffffff"
                  d="M80 299.3V512H196V299.3h86.5l18-97.8H196V166.9c0-51.7 20.3-71.5 72.7-71.5c16.3 0 29.4 .4 37 1.2V7.9C291.4 4 256.4 0 236.2 0C129.3 0 80 50.5 80 159.4v42.1H14v97.8H80z"
                />
              </svg>
            </a>
            <a href="https://twitter.com" target="_blank"
              ><svg
                style="width: 15px"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 512 512"
              >
                <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                <path
                  fill="#ffffff"
                  d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"
                />
              </svg>
            </a>
            <a href="https://linkedin.com" target="_blank">
              <svg
                style="width: 15px"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"
              >
                <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                <path
                  fill="#ffffff"
                  d="M100.3 448H7.4V148.9h92.9zM53.8 108.1C24.1 108.1 0 83.5 0 53.8a53.8 53.8 0 0 1 107.6 0c0 29.7-24.1 54.3-53.8 54.3zM447.9 448h-92.7V302.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V448h-92.8V148.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V448z"
                />
              </svg>
            </a>
          </div>
          <div class="footer-contact">
            <div>
              Contact us:
              <a href="mailto:info@mlfusionlabs.com" style="color: white"
                >info@mlfusionlabs.com</a
              >
              | Phone: +1 (555) 123-4567
            </div>
          </div>
          <div class="footer-links">
            <a href="../pages/privacy.html">Privacy Policy</a> |
            <a href="../pages/terms.html">Terms of Service</a> |
            <a href="../pages/about.html">About Us</a> |
            <a href="../pages/contact.html">Contact</a> |
            <a href="../pages/contributor.html">Contributor</a>
          </div>
          <div>
            &copy; <span id="current-year"></span> ML Fusion Labs | All Rights
            Reserved
          </div>
        </div>
        <button id="scrollTopBtn" onclick="scrollToTop()">
          <svg
            style="width: 20px"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 384 512"
          >
            <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
            <path
              fill="#ffffff"
              d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2 160 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-306.7L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"
            />
          </svg>
        </button>
      </footer>
      <script>
        const scrollTopBtn = document.getElementById("scrollTopBtn");
        window.onscroll = function () {
          if (
            document.body.scrollTop > 20 ||
            document.documentElement.scrollTop > 20
          ) {
            scrollTopBtn.style.display = "block";
          } else {
            scrollTopBtn.style.display = "none";
          }
        };

        function scrollToTop() {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        }
      </script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const coords = { x: 0, y: 0 };
          const circles = document.querySelectorAll(".circle");

          circles.forEach(function (circle, index) {
            circle.x = 0;
            circle.y = 0;
          });

          window.addEventListener("mousemove", function (e) {
            coords.x = e.clientX;
            coords.y = e.clientY;
          });

          function animateCircles() {
            let x = coords.x;
            let y = coords.y;

            circles.forEach(function (circle, index) {
              circle.style.left = x + "px";
              circle.style.top = y + "px";

              circle.style.scale = (circles.length - index) / circles.length;
              circle.x = x;
              circle.y = y;

              const nextCircle = circles[index + 1] || circles[0];
              x += (nextCircle.x - x) * 0.3;
              y += (nextCircle.y - y) * 0.3;
            });

            requestAnimationFrame(animateCircles);
          }

          animateCircles();
        });
      </script>
      <script src="../script/scroll.js"></script>
      <script src="../script/script.js"></script>
      <script src="../script/projects.js"></script>
      <script>
        window.embeddedChatbotConfig = {
          chatbotId: "rKhBc1qcW7yrIovRvB5c4",
          domain: "www.chatbase.co"
        }
      </script>
<script
src="https://www.chatbase.co/embed.min.js"
chatbotId="rKhBc1qcW7yrIovRvB5c4"
domain="www.chatbase.co"
defer>
</script>
    </body>
  </html>
  